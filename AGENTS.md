Step 6: Clean up legacy paths and finalize test coverage
Scope: Remove any now-unused or redundant routes and ensure all tests and documentation are up-to-date. This includes the old ID-based user and post routes, as well as any references to outdated paths. We will also configure any final redirects for stragglers and confirm that test coverage is 100% green.
Affected Files:
Eliminate the users/[userId] and newsletters/[userId] profile routes. These were earlier ways to access a user’s posts (the code in users/[id] and newsletters/[id] pages is similar to the profile page)
github.com
github.com
. With the introduction of username-based profiles, these are no longer needed. We should delete src/app/users/[userId]/page.tsx and src/app/newsletters/[userId]/page.tsx (and their directories if empty). Before removing, double-check that nothing in the app still points to those URLs. It’s likely none do, since we moved to /profile/[username]. If we want to be extra cautious about external links, we can implement redirects: e.g. if someone visits /newsletters/12345, we could redirect to the corresponding /@username. Doing this dynamically would require looking up the user by ID. We can add a short middleware handler: in middleware.ts, if pathname matches /newsletters/<id> or /users/<id>, perform a Supabase lookup of that user’s username and rewrite to /@username. However, given that this is an internal product (or if SEO is not a concern for these endpoints), we might skip that complexity and assume these weren’t heavily used externally. In any case, removing those pages streamlines the codebase.
Remove the now-obsolete profile/[username] page if we decide to serve profiles differently. This is a consideration: since we have the middleware mapping /@username to /profile/[username], we might keep profile/[username] as the underlying page. That’s fine. Alternatively, we could rename profile/[username] to something like users/[username] or even move it to the root of (public) as [username] with a catch-all. But these changes are not strictly needed – the current middleware + profile page approach works. It may be best to leave it as is, but just be aware that the /profile prefix is effectively an implementation detail hidden from users. We should ensure no user-facing link says “/profile/username”; all should use /@username. (The Navbar already does, and our earlier steps ensure most places use @ form.)
Remove any duplicate or unused components related to old routes. For example, if there was a separate SubscribeButton logic for newsletters vs profiles, unify them if not already. Also, if the Navbar had logic specifically for highlighting old paths (like maybe it considered /newsletters as a special case), that can be cleaned. Similarly, in next.config.ts the redirect patterns that excluded newsletters and users in the root slug redirect
github.com
 might be updated: since we no longer serve newsletters/* and users/* as pages, those can be removed from the exclusion list. (Though leaving them is harmless; it just means we won’t mistakenly redirect those patterns to /collectives.)
Final polish: update documentation (the README’s “Routing Updates” section
github.com
) to reflect the new structure: e.g. “User profiles are now accessed at /@username (instead of /newsletters/[id]), and posts at /posts/[slug] (instead of /posts/[id] or /collectives/[slug]/[id]). Old URLs will redirect to the new format.” This isn’t code, but it’s an important step for completeness.
Test Updates: With legacy routes removed, we should remove or adapt any tests that were directly testing those routes:
There might have been tests for the /users/[id] or /newsletters/[id] pages – perhaps checking that they show posts to subscribers vs not. Since we removed those pages, their logic is consolidated in the profile page tests (if any). If such tests exist, either delete them or replace them with tests hitting the new profile page. For example, if there was a test “newsletter page shows only public posts to non-subscribers,” we now test the same on the profile (username) page. The underlying logic is the same (controlled by RLS and our page filtering by is_public), so a simple navigation to /@username in a test and checking visible posts can suffice.
Re-run the entire test suite. At this point, all tests should pass. Fix any lingering failures: e.g. snapshot mismatches due to removed components, broken import paths due to file deletions, etc. Pay particular attention to the e2e tests to ensure the user journey is smooth. A useful final test is to simulate a complete flow: go to landing page, click on a post (now slug URL), attempt to comment (gets redirected to sign-in), sign in, get redirected back to the post, leave a comment, then navigate to the author’s profile via the post page, etc. This ensures our redirects (like preserving redirect query on sign-in) still work, and that the slug routes integrate with auth. The middleware already appends ?redirect= on auth redirects
github.com
, so as long as it’s unchanged, it should still capture “/posts/<slug>” properly when bouncing an unauthenticated user.
Expected Outcome: The codebase is now free of deprecated route handling. All content is accessible through one clear path only, which improves maintainability and eliminates confusion. For example, there is no longer both /users/123 and /profile/alice serving the same purpose – only /@alice exists (backed by one profile page). Similarly, there is no duplicate post view page for collective vs personal posts – just one slug-based page. This reduces potential bugs and makes the navigation architecture easier to reason about. All tests are passing, and coverage is updated to reflect the new reality (no references to old URLs). Visually and functionally, the app should behave the same or better: users get a consistent UI tailored to their context (public site vs. logged-in app vs. editor), and the URLs they share are meaningful. We have maintained visual consistency throughout (no design overhaul was done, just structural reorganization), so there should be no surprises for end users aside from nicer URLs. The transition is smooth: old links redirect, and the site’s navigation (both in the UI and in the address bar) is now organized according to audience (public, auth, app, editor), exactly as proposed.
