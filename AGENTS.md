6. Final App Router Compatibility Cleanup
Root Cause: Ensuring full compatibility with Next.js App Router involves using the new file conventions and removing any legacy patterns that might linger. Now that specific errors are fixed, a final pass will prevent future issues.
Solution: Add and update special App Router files and patterns as needed:
Global Error and 404 Handling: As mentioned, include an app/not-found.tsx to handle notFound() calls gracefully. Similarly, consider adding an app/error.tsx (and/or error.js in nested routes if needed) to catch unhandled exceptions with a user-friendly message. This isn’t directly a TypeScript fix but aligns the app with Next 15 conventions and prevents runtime surprises.
Remove Unused Legacy Code: If the project still has any remnants of the Pages Router (like an old pages/_app.js or similar), delete them since you’re on App Router exclusively. Also remove any imports from 'next/router' (there appear to be none, as a search confirmed) and ensure no outdated functions like Router.push are in use. All navigation should go through <Link> or useRouter().push() in client components.
Verify Client vs Server Components: Double-check that components interacting with state, context, or browser APIs are marked with "use client". Conversely, ensure purely presentational components (or heavy data-fetching components) remain server components for performance. For example, your SmoothScroll component is correctly a client component
github.com
. On the other hand, layout and page components default to server – which is fine as long as you don’t put client-only code in them. This separation doesn’t necessarily throw type errors, but improper usage can cause runtime issues or hydration warnings. It’s worth reviewing now.
Test Routing of Dynamic Segments: With the param type fixes, test that pages like /posts/[postId] and /collectives/[collectiveSlug]/[postId] load correctly and that navigation (possibly using useRouter() for programmatic nav) works without errors. The removal of the Promise wrapper means those page components will receive params immediately. This should simplify things and remove console warnings about Promise usage.
Result: After this cleanup step, the codebase will be fully updated to Next.js 15 and TypeScript 5.8 conventions. All 70+ errors should be resolved by the above changes. The app will use the App Router APIs correctly, have properly typed dynamic routes, no module resolution issues, and clean, type-safe interactions with Supabase and Lexical. Each fix is scoped by file and issue type, which should make the changes manageable and verify each category of error is handled in turn. Finally, run npm run build (or your build command) to ensure the TypeScript compiler reports 0 errors, confirming that all the fixes have been applied successfully.
