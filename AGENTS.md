Enhance Subscribe Button to Handle Tier Selection: Modify the subscription flow so that subscribers can choose a tier instead of always using the single default price. The SubscribeButton component currently uses a fixed priceId (from env or props) and immediately opens Stripe Checkout
github.com
. We want to allow multiple options. A straightforward approach is to turn the single Subscribe button into a small dropdown or modal that lists available tiers for that target (user or collective). When rendering SubscribeButton, fetch the available prices for the target: for a collective, query prices by collective’s product; for a user, if we have multiple, do similarly (or if only default, just one option). This could be done server-side and passed down, or client-side via an API call. For simplicity, you might create a new API route like /api/tiers/[entityType]/[entityId] that returns the list of active tiers (name, price, interval, stripe price ID) for that entity, which the SubscribeButton can call on mount. However, since SubscribeButton is a client component, we can also pass in a list of tiers as props from the server component. For example, in users/[userId]/page.tsx, after fetching posts, fetch prices for that user’s product (or null if none) and pass an array of tiers to the SubscribeButton. Then, update SubscribeButton.tsx to conditionally render either:
If multiple tiers: render a small menu. Possibly use a <Select> dropdown or a popover menu. Each option calls the subscribe action with the respective priceId.
If one tier: behave as before with a single button.
For instance, you could use a state like showOptions toggled by clicking the Subscribe button: on click, if multiple tiers and not already choosing, instead of directly calling checkout, expand a list of buttons (one per tier) or a select input. Each tier option, when clicked, triggers handleSubscribe(priceId) with that specific price. The handleSubscribe function already sends priceId to the /api/subscribe endpoint
github.com
. We must ensure that endpoint can accept any valid price: it currently uses priceId === "default" to substitute process.env.STRIPE_PRICE_ID
github.com
, which was a global fallback. We should adjust this logic: if multiple tiers are supported, we likely store actual Stripe price IDs in the DB, so we can remove the "default" substitution or use it only if a creator hasn’t set up any tier and the default env is to be used. Essentially, send the actual priceId (e.g., "price_12345") for each tier selection. The subscribe API will create a Checkout Session for that price as usual. On the UI side, label the tier options clearly – e.g., “Subscribe to Gold Plan – $10/month”. Use the price metadata (unit_amount and interval) to format the label. The prices table gives unit_amount in cents and interval in the interval field
github.com
; combine that to human-readable form. Also consider free tiers: if in the future a free tier is an option (e.g., $0), you might integrate that with follow instead of Stripe, but it could be shown as well. Throughout this change, test the subscribe flow with multiple tiers to make sure selecting a tier correctly redirects to Stripe Checkout for that price and that the webhook still records the subscription with the correct stripe_price_id. We maintain backward compatibility by still supporting a single default price (the UI will just show one option or directly go to checkout, unchanged for creators who have only one tier).
